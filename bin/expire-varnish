#!/bin/sh
#
# Flush the sole varnish cache
#

#
#  If you're not using varnish unset this.
#
host=212.110.179.78:6082


#
#  If we have a host then set the flag.
#
if [ ! -z "$host" ]; then
  host="-T $host"
fi


#
#  If we have varnishadmin then purge the site
#
[ -x /usr/bin/varnishadm ] && varnishadm $host 'ban req.url ~ /'

#
#  If we have the messager then expire it
#
if [ -x /root/current/bin/alert ]; then
    /root/current/bin/alert "Flushed cache"
fi
